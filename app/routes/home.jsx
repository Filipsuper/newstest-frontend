import { useEffect, useState } from "react";
import { pnlColor } from "../utils/utils";
import { fetchArticle } from "../utils/api";
import dayjs from "dayjs";
import ArticleComponent from "../components/ArticleComponent";

export function meta() {
  return [
    { title: "Morningsum - Daily Stock Market Summary" },
    { name: "description", content: "Daily summary of the Swedish stock market generated by AI" },
  ];
}

export default function Home() {
  const [articles, setArticles] = useState();

  useEffect(() => {
    const fetchData = async () => {
      try {
        const data = await fetchArticle();
        setArticles(data);
      } catch (error) {
        console.error("Error fetching data:", error);
      }
    };
    fetchData();
  }, []);

  if (!articles) {
    return <div className="text-text">Loading...</div>;
  }

  return (
    <main className="min-h-screen bg-background relative py-4 md:p-4">
      <div className="absolute inset-0 z-20 bg-[url(https://grainy-gradients.vercel.app/noise.svg)] opacity-20 pointer-events-none"></div>
      <header className="max-w-4xl mx-auto px-4 mt-8 relative z-10">
        <h1 className="text-4xl font-serif font-black text-text italic pb-2">Morningsum</h1>
        <p className="text-lg text-text-muted mb-4 prose">Morningsum is a daily summary of the stock market focusing on the Swedish Market. The summary is generated by an LLM based on the latest market news and data. The summary is updated daily at 08:30 CEST</p>
      </header>
      <ArticleComponent article={articles[0]} />
      <div className="max-w-4xl mx-auto px-4 mt-8 relative z-10">
        <h2 className="text-2xl font-serif font-black text-text italic mb-4 mt-8">Previous Summaries</h2>
        {articles.slice(1).map((article, idx) => (
          <ArticleComponent key={idx} article={article} />
        ))}
      </div>

      <footer className="max-w-4xl mx-auto px-4 mt-8 relative z-10">
        <p className="text-text-muted text-sm mb-4">Â© 2025 Morningsum</p>
      </footer>
    </main>
  );
}